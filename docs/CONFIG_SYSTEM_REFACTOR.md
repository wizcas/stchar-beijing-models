# é…ç½®ç³»ç»Ÿé‡æ„è¯´æ˜

## æ¦‚è¿°

å°†é…ç½®ç³»ç»Ÿé‡æ„ä¸º**å•ä¸€çœŸå®æ¥æº (Single Source of Truth)** æ¨¡å¼ã€‚ç°åœ¨ `status.yaml` æ˜¯å”¯ä¸€çš„é…ç½®æºï¼Œæ‰€æœ‰å…¶ä»–é…ç½®æ–‡ä»¶éƒ½ä»å®ƒç”Ÿæˆã€‚

## æ–‡ä»¶èŒè´£

### ğŸ“‹ data/status.yamlï¼ˆå”¯ä¸€çœŸå®æ¥æºï¼‰
**å®Œæ•´çš„ schema + é»˜è®¤å€¼ + æ–‡æ¡£**

åŒ…å«ï¼š
- å­—æ®µå®šä¹‰å’Œç±»å‹çº¦æŸï¼ˆ`$enum`, `$range`, `$list`, `$ro`ï¼‰
- æ‰€æœ‰å­—æ®µçš„é»˜è®¤å€¼
- å­—æ®µçš„è¯¦ç»†è¯´æ˜ï¼ˆdescriptionï¼‰

ç¼–è¾‘æ–¹å¼ï¼š**ç¼–è¾‘æ­¤æ–‡ä»¶ä»¥æ›´æ–°ä»»ä½•é…ç½®**

ç¤ºä¾‹ï¼š
```yaml
ä¸–ç•Œ:
  description: "å½“å‰ä¸–ç•ŒçŠ¶æ€"
  fields:
    æ—¶é—´:
      type: "string"
      description: "ISO8601æ ¼å¼çš„æ—¥æœŸå’Œæ—¶é—´"
      default: "2024-12-16T14:30:00+0800"
    å •è½åº¦:
      type: "$range=[0,100]"
      description: "é“å¾·å •è½ç¨‹åº¦"
      default: 0
```

### ğŸ“¦ data/status.jsonï¼ˆä»…åŒ…å«å€¼ï¼Œè‡ªåŠ¨ç”Ÿæˆï¼‰
**ç®€åŒ–çš„æ•°æ®æ–‡ä»¶ï¼Œä¸å«ç±»å‹å‰ç¼€**

åŒ…å«ï¼š
- æ‰€æœ‰å­—æ®µçš„å½“å‰å€¼
- å¹²å‡€çš„ç»“æ„ï¼Œæ—  White-X å‰ç¼€

âš ï¸ **ä¸åº”æ‰‹åŠ¨ç¼–è¾‘**

è‡ªåŠ¨ç”Ÿæˆï¼š`node build-config.js`

ç¤ºä¾‹ï¼š
```json
{
  "ä¸–ç•Œ": {
    "æ—¶é—´": "2024-12-16T14:30:00+0800"
  },
  "{{user}}": {
    "èµ„é‡‘": 10000,
    "å •è½åº¦": 0
  }
}
```

### ğŸ§ª data/status-vars.debug.jsonï¼ˆæµ‹è¯•æ•°æ®ï¼Œè‡ªåŠ¨ç”Ÿæˆï¼‰
**ç”¨äºæœ¬åœ°æµ‹è¯•çš„å®Œæ•´æ•°æ®ï¼ŒåŒ…å«ç±»å‹å‰ç¼€**

åŒ…å«ï¼š
- æ‰€æœ‰å­—æ®µçš„é»˜è®¤å€¼
- White-X æ ¼å¼çš„å­—æ®µå‰ç¼€
- ç¬¦åˆ "çŠ¶æ€æ " schema çš„ç»“æ„

âš ï¸ **ä¸åº”æ‰‹åŠ¨ç¼–è¾‘**

è‡ªåŠ¨ç”Ÿæˆï¼š`node build-config.js`

ç¤ºä¾‹ï¼š
```json
{
  "çŠ¶æ€æ ": {
    "å°äºŒ": {
      "$range=[0,100] å •è½åº¦": 0,
      "$list æ‹æ‘„ä»»åŠ¡": [...]
    }
  }
}
```

## å·¥ä½œæµ

### æ·»åŠ æˆ–ä¿®æ”¹å­—æ®µ

1. **ç¼–è¾‘ `data/status.yaml`**
   ```yaml
   {{user}}:
     fields:
       æ–°å­—æ®µ:
         type: "string"
         description: "å­—æ®µè¯´æ˜"
         default: "é»˜è®¤å€¼"
   ```

2. **è¿è¡Œæ„å»ºè„šæœ¬**
   ```bash
   node build-config.js
   ```
   
   è¿™ä¼šè‡ªåŠ¨ï¼š
   - ç”Ÿæˆæ›´æ–°çš„ `status.json`
   - ç”Ÿæˆæ›´æ–°çš„ `status-vars.debug.json`

3. **éªŒè¯é…ç½®**
   ```bash
   node verify-config.js
   ```
   
   æ£€æŸ¥ï¼š
   - schema å®šä¹‰æ˜¯å¦æœ‰æ•ˆ
   - æ‰€æœ‰å­—æ®µæ˜¯å¦æœ‰é»˜è®¤å€¼
   - é»˜è®¤å€¼æ˜¯å¦ç¬¦åˆç±»å‹çº¦æŸ

### ä¿®æ”¹å­—æ®µçš„é»˜è®¤å€¼

ç›´æ¥ç¼–è¾‘ `status.yaml` ä¸­çš„ `default` å€¼ï¼Œç„¶åè¿è¡Œ `build-config.js`ã€‚

### ä¿®æ”¹å­—æ®µçš„çº¦æŸ

ç¼–è¾‘ `status.yaml` ä¸­çš„ `type` å­—æ®µã€‚ä¾‹å¦‚ï¼š

```yaml
å •è½åº¦:
  type: "$range=[0,100]"  # ä¿®æ”¹èŒƒå›´
  default: 0
```

ç„¶åè¿è¡Œ `build-config.js` å’Œ `verify-config.js`ã€‚

## å¥½å¤„

âœ… **å•ä¸€æ¥æº** - æ‰€æœ‰é…ç½®ä¿¡æ¯åœ¨ä¸€ä¸ªåœ°æ–¹  
âœ… **å‡å°‘é‡å¤** - ä¸éœ€è¦åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ç»´æŠ¤ç›¸åŒçš„çº¦æŸ  
âœ… **è‡ªåŠ¨åŒæ­¥** - æ„å»ºè„šæœ¬è‡ªåŠ¨ä¿æŒæ–‡ä»¶ä¸€è‡´  
âœ… **æ˜“äºç»´æŠ¤** - ä¿®æ”¹é…ç½®åªéœ€ç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶  
âœ… **å®Œæ•´æ–‡æ¡£** - `description` å­—æ®µä¸ºæ¯ä¸ªå­—æ®µæä¾›è¯´æ˜  

## ç±»å‹çº¦æŸå‚è€ƒ

### åŸºæœ¬ç±»å‹
```yaml
å­—æ®µå:
  type: "string"    # å­—ç¬¦ä¸²
  type: "number"    # æ•°å­—
  type: "object"    # å¯¹è±¡
```

### White-X ç‰¹æ®Šç±»å‹
```yaml
å­—æ®µå:
  type: "$ro"                    # åªè¯»
  type: "$range=[0,100]"         # æ•°å€¼èŒƒå›´
  type: "$enum={é€‰é¡¹1;é€‰é¡¹2}"    # æšä¸¾
  type: "$list"                  # åˆ—è¡¨
```

## è„šæœ¬è¯´æ˜

### build-config.js
ç”Ÿæˆé…ç½®æ–‡ä»¶

```bash
node build-config.js
```

æµç¨‹ï¼š
1. ä» `status.yaml` è¯»å– schema å’Œé»˜è®¤å€¼
2. æå–é»˜è®¤å€¼ï¼Œç”Ÿæˆ `status.json`
3. æ·»åŠ ç±»å‹å‰ç¼€ï¼Œç”Ÿæˆ `status-vars.debug.json`

### verify-config.js
éªŒè¯é…ç½®çš„å®Œæ•´æ€§

```bash
node verify-config.js
```

æ£€æŸ¥ï¼š
- YAML æ˜¯å¦æœ‰æ•ˆ
- æ‰€æœ‰å­—æ®µæ˜¯å¦æœ‰ `default` å€¼
- é»˜è®¤å€¼æ˜¯å¦ç¬¦åˆç±»å‹çº¦æŸ
- ç”Ÿæˆçš„æ–‡ä»¶æ˜¯å¦æœ‰æ•ˆ

### npm è„šæœ¬
```bash
pnpm config:build    # è¿è¡Œ build-config.js
pnpm config:verify   # è¿è¡Œ verify-config.js
```

## è¿ç§»æŒ‡å—

å¦‚æœä»æ—§çš„é…ç½®ç³»ç»Ÿè¿ç§»ï¼š

1. æ›´æ–° `status.yaml`ï¼š
   - æ·»åŠ æ‰€æœ‰å­—æ®µçš„ `default` å€¼
   - æ·»åŠ  `description` è¯´æ˜
   - éªŒè¯ç±»å‹çº¦æŸ

2. æ¸…ç† `status.json`ï¼š
   - ç§»é™¤æ‰€æœ‰çš„ç±»å‹å‰ç¼€
   - ä»…ä¿ç•™å­—æ®µå€¼

3. è¿è¡Œæ„å»ºå’ŒéªŒè¯ï¼š
   ```bash
   node build-config.js
   node verify-config.js
   ```

## ç¤ºä¾‹æµç¨‹

```bash
# 1. ç¼–è¾‘ status.yamlï¼ˆæ·»åŠ æ–°å­—æ®µæˆ–ä¿®æ”¹å€¼ï¼‰
vim data/status.yaml

# 2. ç”Ÿæˆæ–°çš„é…ç½®æ–‡ä»¶
pnpm config:build

# 3. éªŒè¯é…ç½®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§
pnpm config:verify

# 4. æäº¤æ›´æ”¹
git add data/status.yaml
git commit -m "Update configuration"
```

## å¸¸è§é—®é¢˜

**Q: å¦‚æœæˆ‘æ‰‹åŠ¨ç¼–è¾‘ status.json ä¼šæ€æ ·ï¼Ÿ**
A: ä¸‹æ¬¡è¿è¡Œ `build-config.js` æ—¶ï¼Œæ‚¨çš„ç¼–è¾‘ä¼šè¢«è¦†ç›–ã€‚è¯·æ”¹ä¸ºç¼–è¾‘ `status.yaml`ã€‚

**Q: status-vars.debug.json çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ**
A: è¿™æ˜¯ç”¨äºæœ¬åœ°æµ‹è¯•çš„å®Œæ•´æ•°æ®æ–‡ä»¶ï¼ŒåŒ…å«ç±»å‹å‰ç¼€ï¼Œç¬¦åˆ White-X çš„å˜é‡æ ¼å¼ã€‚

**Q: æˆ‘éœ€è¦æ‰‹åŠ¨ç¼–è¾‘ status-vars.debug.json å—ï¼Ÿ**
A: ä¸éœ€è¦ã€‚å®ƒæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ä»»ä½•æ‰‹åŠ¨ç¼–è¾‘éƒ½ä¼šåœ¨ä¸‹æ¬¡è¿è¡Œ `build-config.js` æ—¶è¢«è¦†ç›–ã€‚
