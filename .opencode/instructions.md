# Beijing Models - OpenCode Project Instructions

## 项目概况

这是一个 SillyTavern 角色卡配置系统，模拟网络人体摄影行业的爱恨情仇与道德抉择。

## Worldbooks 文件标准

### 1. Token 优化是重要目标

每个 worldbooks 下的 markdown 文件都会被加载到角色卡的提示词中，直接影响 LLM 的上下文大小。

**要求**：
- 始终将 **token count 优化** 作为重要目标
- 删除冗余的解释和重复内容
- 使用更紧凑的格式表达相同信息
- 定期审查文件大小，目标是保持在 1000-2000 tokens 以内（除非特殊情况）

**优化策略**：
- ✅ 合并相似的条款和说明
- ✅ 用公式或简洁的结构替代详细例子
- ✅ 移除"请注意"之类的冗余警告文本
- ✅ 使用列表而非段落解释
- ❌ 避免重复论述相同概念

### 2. 严禁使用 Markdown 表格

Markdown 表格在文本格式中往往产生大量空白字符，浪费 tokens。

**禁止**：
```markdown
| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 值  | 值  | 值  |
```

**推荐方案**：

#### 方案 A：使用 YAML 结构化数据

```yaml
堕落度阶段:
  0-20_专业:
    描述: 严格遵守职业操守
    行为: 维护专业形象
  
  21-40_妥协:
    描述: 言语中开始带有暗示
    行为: 偶尔做出不当建议
```

#### 方案 B：使用列表格式

```
数据名称:
  - 项1: 详细说明
  - 项2: 详细说明
  - 项3: 详细说明
```

#### 方案 C：使用简洁的键值对

```
状态A: 描述文本，触发条件，后果列表
状态B: 描述文本，触发条件，后果列表
```

### 3. 文件组织原则

**worldbooks 文件结构**：
```
worldbooks/
  opening.md              # 开场故事（禁止修改）
  {{user}}.md             # 用户角色设定（禁止修改）
  status.md               # 状态字段使用指南
  equipment-requirements.md    # 装备系统
  photographer-system.md      # 摄影师任务系统
  model-system.md             # 模特任务系统
  moral-system.md             # 堕落度系统
  favor-system.md             # 好感度系统
  censorship-system.md        # 审查制度/尺度等级
```

### 4. 各文件的 Token 预算

| 文件 | 目标 | 优先级 | 说明 |
|------|------|--------|------|
| opening.md | - | 禁止 | 开场故事，禁止修改 |
| {{user}}.md | - | 禁止 | 角色设定，禁止修改 |
| status.md | 1000-1500 | 高 | 状态字段指南，支持详细说明 |
| equipment-requirements.md | 2000-2500 | 高 | 装备系统，允许详细规则 |
| photographer-system.md | 1200-1800 | 高 | 任务系统，需要精简 |
| model-system.md | 1200-1800 | 高 | 任务系统，需要精简 |
| moral-system.md | 1000-1500 | 中 | 堕落度系统，可优化 |
| favor-system.md | 1000-1500 | 中 | 好感度系统，可优化 |
| censorship-system.md | 1000-1500 | 中 | 尺度系统，可优化 |
| **总计** | **< 13000** | - | **所有 worldbooks 总 tokens 应保持在 13000 以内** |

### 5. 文件编辑检查清单

修改或创建 worldbooks 文件时，必须满足以下条件：

- [ ] **无 Markdown 表格**：搜索 `|` 符号，确保没有表格结构
- [ ] **Token 优化**：使用文本编辑器的字数统计或在线工具验证
- [ ] **结构化数据**：复杂数据使用 YAML、XML 或列表格式
- [ ] **去冗余**：检查是否有重复的解释或冗余的词汇
- [ ] **可读性**：确保紧凑后仍然清晰易懂
- [ ] **格式一致性**：与项目中其他文件保持风格统一
- [ ] **链接完整性**：使用 `@worldbooks/filename.md` 引用其他文件

### 6. 常见 Token 浪费情况

避免以下模式：

```markdown
❌ 冗余警告
"请注意，这是一个重要的规则。这个规则必须被遵守。"

✅ 简洁表达
"硬性规则：必须遵守。"

---

❌ 过度解释
"好感度会影响模特的行为。当好感度提升时，
模特会变得更加友好。当好感度下降时，
模特会变得更加警惕。这直接影响拍摄的难度。"

✅ 精简表达
"好感度影响模特态度：高感→友好，低感→警惕。"

---

❌ 冗长列表
- 这是第一项，它的意思是......
- 这是第二项，它的意思是......
- 这是第三项，它的意思是......

✅ 紧凑列表
- 项1: 简洁说明
- 项2: 简洁说明
- 项3: 简洁说明
```

## 配置文件规范

### data/ 目录

```
data/
  status.yaml          # Schema 定义（单源真实）
  status.json          # 覆盖值（可选）
  status-vars.debug.json  # 生成的调试文件（勿修改）
```

**规则**：
- `status.yaml` 是唯一的配置真实来源
- `status.json` 仅用于覆盖特定字段的默认值
- 运行 `build-config.js` 生成 `status-vars.debug.json`

### 验证命令

```bash
# 验证配置有效性
node verify-config.js

# 生成调试数据
node build-config.js
```

## 开发工作流

### 修改 worldbooks 文件时

1. **编辑文件**
2. **验证格式**：确保无 Markdown 表格
3. **检查 tokens**：运行字数统计，估算 token 消耗
4. **Git 提交**：
   ```bash
   git add worldbooks/filename.md
   git commit -m "描述变更内容和优化成果"
   ```

### 修改配置文件时

1. **编辑 `data/status.yaml` 或 `data/status.json`**
2. **验证配置**：`node verify-config.js`
3. **生成调试数据**：`node build-config.js`
4. **检查输出**：确保 `status-vars.debug.json` 正确生成
5. **Git 提交**

## 禁止的操作

❌ 修改 `worldbooks/opening.md`  
❌ 修改 `worldbooks/{{user}}.md`  
❌ 在 worldbooks 中使用 Markdown 表格  
❌ 添加大量重复或冗余的解释文本  
❌ 使用未经验证的新配置字段  

## 受欢迎的改进

✅ 删除冗余文本，优化 token 消耗  
✅ 将表格转换为 YAML 或列表  
✅ 优化系统设计，减少重复说明  
✅ 完善规则的清晰度和简洁性  
✅ 添加新的游戏机制或故事情节  

## 项目特殊说明

这个项目的核心是：**在肉欲、美色和经济压力的围困下，{{user}}如何选择？艺术理想还是欲望堕落？**

所有系统设计都应该围绕这个主题，避免添加与核心主题无关的复杂规则。

---

*最后更新：2025-11-15*
