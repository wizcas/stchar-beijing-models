# White-X 脚本集合

本文件夹包含与 White-X 插件集成的 JavaScript 脚本。

## extract-context.js

White-X 上下文信息提取脚本（纯 STScript 实现）。使用 STScript 读取变量并生成 XML 格式的上下文字符串。

### 功能

该脚本提取以下数据：

**世界信息**
- 时间（ISO8601 格式）
- 地点

**用户（摄影师）数据**
- 拍摄任务（任务列表）
- 资金（数值）
- 堕落度（数值）

**女性角色数据**
- 好感度
- 堕落度
- 动情程度
- 尺度
- 人设

### 使用方法

在 White-X 消息中或角色卡中执行以下 JavaScript 代码块：

```javascript
// 复制 extract-context.js 中的代码并在 White-X 中执行
(async () => {
  // ... extract-context.js 的代码内容 ...
})();
```

或在开发环境中通过控制台执行脚本文件。

### 输出格式

脚本会在控制台输出格式化的 JSON：

```json
{
  "世界": {
    "时间": "2024-12-16T14:30:00+0800",
    "地点": "[北京]昌平仓库工作室"
  },
  "用户": {
    "拍摄任务": [...],
    "资金": 10000,
    "堕落度": 0
  },
  "女性角色": {
    "六花": {
      "好感度": 0,
      "堕落度": 0,
      "动情程度": null,
      "尺度": null,
      "人设": null
    }
  }
}
```

并通过 STScript 注入 XML 格式的上下文到对话：

```xml
<context>
{"世界":{"时间":"2024-12-16T14:30:00+0800","地点":"[北京]昌平仓库工作室"},"用户":{"拍摄任务":[...],"资金":10000,"堕落度":0},"女性角色":{"六花":{"好感度":0,"堕落度":0,"动情程度":null,"尺度":null,"人设":null}}}
</context>
```

脚本会：
1. 使用 STScript 读取 `/getvar 状态栏` 获取所有数据
2. 提取所需字段组织为结构化数据
3. 在控制台输出格式化的 JSON
4. 通过 `/inject` 命令将 XML 格式的上下文注入到对话（作为临时用户消息）

### 依赖

- STScript API（`/getvar`, `/setvar`）
- 无外部依赖，纯原生 JavaScript

### 注意事项

- 脚本必须在 White-X 或支持 STScript 的环境中执行
- 需要 `/getvar 状态栏` API 的访问权限
- 提取的数据结构基于当前的状态栏数据格式
