rule_name: 状态栏系统
rule_key: 状态栏,plot-log,YAML,数据结构
version: 1
rule_type: 技术规范
rule_type_describe: 定义 status.yaml 的完整数据结构和 plot-log 操作方式
filename: status.md

---

<status>

# 状态栏系统 (plot-log 操作指南)

**🔴 重要提示**：详细的 plot-log 格式规范已独立提取到 <plot-log-format-guide />，所有 plot-log 输出必须严格遵守该文档的规范。本文档主要定义状态结构 schema。

## ⚠️ 严格规范

### 1. 数组输出格式（必须遵守）

详见 <plot-log-format-guide />

### 2. Schema 严格遵守

- **禁止** 新增或修改任何字段结构（包括字段名、嵌套层级）
- **必须** 完全遵守下述 schema 定义
- 所有 plot-log 输出必须与 status.yaml 的 schema 完全对应

---

## 状态结构 Schema

### 世界 (`状态栏.世界`)

| 字段     | 类型          | 说明                   | 约束                                               |
| -------- | ------------- | ---------------------- | -------------------------------------------------- |
| 时间     | string        | 当前时间               | ISO8601 格式 + 时区，如 `2024-12-16T14:30:00+0800` |
| 地点     | string        | 当前地点               | 格式: `[国家/城市]具体位置`                        |
| 天气     | string        | 天气描述               | 自然语言简述                                       |
| 出场女模 | array(string) | 当前场景中活跃女模名字 | **展开格式数组**，每个元素一行                     |

**出场女模数组 - 唯一正确写法**：

```yaml
记下:
  状态栏.世界.出场女模:
    - 六花
    - 梦瑶
```

---

### User (`状态栏.user`)

#### 基本字段

| 字段       | 类型   | 范围                 | 说明                     |
| ---------- | ------ | -------------------- | ------------------------ |
| 行业等级   | enum   | 专业 \| 资深 \| 名家 | 摄影师专业等级           |
| 堕落度     | int    | 0-100                | 道德堕落程度             |
| 堕落度描述 | string | -                    | 根据堕落度自动生成的描述 |
| 穿搭       | string | -                    | 着装描述                 |
| 想法       | string | -                    | 内心想法                 |
| 资金       | number | -                    | 可用资金                 |

#### 拍摄任务字段 (`状态栏.user.拍摄任务`)

**类型**: object（自由键值对）

**Key 格式** (必须严格遵守)：`模特名--日期-时间`

- 日期: `yyyy-mm-dd` 格式
- 时间: `HHMM` 格式（24小时，无冒号），如 `1430`、`0900`、`晚上`

**任务对象必需字段**（必须每次都包含）：

| 字段     | 类型   | 说明                                               |
| -------- | ------ | -------------------------------------------------- |
| 状态     | enum   | 未开始 \| 进行中 \| 已完成 \| 已取消               |
| 模特     | string | 女模名字                                           |
| 目标     | string | 任务目标/内容描述                                  |
| 期限     | string | 期限日期和时间，格式 `yyyy-mm-dd HH:MM` 或笼统描述 |
| 报酬     | number | 报酬金额                                           |
| 特殊要求 | string | 特殊要求/备注                                      |

**拍摄任务输出格式**（必须严格遵守）：

```yaml
记下:
  状态栏.user.拍摄任务.六花--2024-12-31-1430:
    状态: 未开始
    模特: 六花
    目标: 商业写真集拍摄
    期限: 2024-12-31 14:30
    报酬: 5000
    特殊要求: 包含古装和现代风格对比
```

#### 器材字段 (`状态栏.user.器材`)

**结构**：object，包含以下字段

| 字段      | 类型          | 说明                   |
| --------- | ------------- | ---------------------- |
| 器材.机身 | array(string) | 相机机身列表，展开格式 |
| 器材.镜头 | array(string) | 镜头列表，展开格式     |
| 器材.灯光 | array(string) | 灯光设备列表，展开格式 |
| 器材.配件 | array(string) | 配件列表，展开格式     |
| 器材.其他 | array(string) | 其他器材列表，展开格式 |

---

### 推进选项 (`状态栏.推进选项`)

**类型**: `$list` 数组

**说明**: 每轮 AI 输出后自动生成的 4 个不同方向的行动方案，指导玩家{{user}}可以采取的下一步行动。

**数据结构**: 每个选项是一个对象，包含以下字段：

| 字段     | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| 选项     | string | 具体的行动方案描述                |
| 方向     | enum   | 积极 \| 消极                     |
| emoji    | string | 表情符号（☺️、😡、😭、🤤 等等） |

**生成规则**：

- 每轮剧情输出完毕后，必须生成 4 个推进选项
- 所有选项必须：
  - 是新颖的，从未在上文中出现过
  - 具有明显区别，能够引导不同的剧情走向
  - 包含积极（正面）和消极（反面）两个方向各 2 个
  - 简短精炼但包含足够的细节
  - 附加恰当的 emoji 表情
- 禁止重复之前出现过的选项

**示例**：

```yaml
记下:
  状态栏.推进选项:
    - 选项: 礼貌地与六花打招呼，询问她对拍摄的想法
      方向: 积极
      emoji: ☺️
    - 选项: 直接提出大尺度拍摄要求
      方向: 消极
      emoji: 😡
    - 选项: 邀请六花进行私人聚餐，了解她的背景
      方向: 积极
      emoji: 💼
    - 选项: 因为初次见面紧张而支支吾吾，显得很不专业
      方向: 消极
      emoji: 😭
```

---

### 女模 (`状态栏.女模.{角色名}`)

**结构**: object，key 为角色名（唯一标识），value 为该角色的完整数据对象

#### 女模的完整 Schema

每个女模对象必须包含以下结构（新女模首次出现时必须生成完整数据）：

```
女模.{角色名}:
  想法: string
  关系:
    堕落度: int(0-100)
    堕落度描述: string
    好感度: int(-100~100)
    好感度描述: string
  外型:
    五官: string
    发型: string
    穿搭: string
    身高: int(160-175)
    体重: int(45-60)
    胸围: int(78-95)
    腰围: int(55-68)
    臀围: int(85-100)
    罩杯: string
  职业:
    类型: array(string)
    层级: enum(新手|进阶|专业)
    方向: enum(专业|多元|退出|卖身)
    尺度: enum(清纯|性感|大尺度|私密)
    人设: array(string)
  性爱:
    性癖: array(string)
    性经验次数: int(0-10000)
    动情程度: int(0-100)
```

**⚠️ 重要约束**：

- `性爱.乳房`, `性爱.小穴`, `性爱.肛门` 字段**仅在动情程度 ≥ 10 时才生成**
- 首次生成新女模时，这三个字段保持为空或不包含
- 新女模初始数据不应包含详细的身体描述，只有在实际产生性反应时才补充

#### 女模字段详细规范

| 字段路径        | 类型   | 范围                     | 说明              | 更新规则                                   |
| --------------- | ------ | ------------------------ | ----------------- | ------------------------------------------ |
| 想法            | string | -                        | 内心独白          | 每轮对话至少更新一次                       |
| 关系.堕落度     | int    | 0-100                    | 道德堕落程度      | 变化≥2 时同时更新描述                      |
| 关系.堕落度描述 | string | -                        | 堕落状态文字描述  | 必须同步于堕落度数值                       |
| 关系.好感度     | int    | -100~100                 | 对摄影师的感受    | 变化≥3 时同时更新描述                      |
| 关系.好感度描述 | string | -                        | 关系状态文字描述  | 必须同步于好感度数值                       |
| 外型.\*         | 见上表 | -                        | 身体特征          | 一般不变，仅数字型字段有范围约束           |
| 职业.类型       | array  | -                        | 职业标签列表      | 追加新类型                                 |
| 职业.层级       | enum   | 新手\|进阶\|专业         | 模特等级          | 直接覆盖                                   |
| 职业.方向       | enum   | 专业\|多元\|退出\|卖身   | 职业方向          | 直接覆盖                                   |
| 职业.尺度       | enum   | 清纯\|性感\|大尺度\|私密 | 可接受尺度        | 直接覆盖                                   |
| 职业.人设       | array  | -                        | 人设/称呼标签列表 | 追加新标签                                 |
| 性爱.性癖       | array  | -                        | 性癖好列表        | 追加新性癖（仅在有实际动机时）             |
| 性爱.性经验次数 | int    | 0-10000                  | 累计次数          | 有性行为后调整 +1                          |
| 性爱.动情程度   | int    | 0-100                    | 当前兴奋程度      | 实时变化，≥10 时才生成生理状态字段         |
| 性爱.乳房       | string | -                        | 乳房乳头状态      | **仅在动情程度≥10 时生成**，描述应简洁专业 |
| 性爱.小穴       | string | -                        | 阴部状态          | **仅在动情程度≥10 时生成**，描述应简洁专业 |
| 性爱.肛门       | string | -                        | 菊花状态          | **仅在动情程度≥10 时生成**，描述应简洁专业 |

---

## Plot-log 操作说明

输出格式参考 <plot-log-format-guide />

### 操作类型

| 操作 | 说明                    | 使用场景                       |
| ---- | ----------------------- | ------------------------------ |
| 记下 | 直接设置/覆盖值         | 新增、替换、覆盖任何字段       |
| 调整 | 对数值增加或减少（+/-） | 调整数值型字段（金钱、度数等） |
| 追加 | 向数组添加新元素        | 数组字段新增项                 |
| 删除 | **仅能** 删除顶层变量   | 很少使用                       |

### 强制规范

1. **女模首次出场必须生成完整结构，并记录到历史**
   - 新女模第一次出现时，必须输出完整的女模数据对象
   - 包含所有嵌套的字段（想法、关系、外型、职业、性爱）
   - 不允许缺失任何一级结构
   - **强制要求**：使用 `追加` 操作将女模名字记录到 `状态栏.历史.女模` 数组中

   ```yaml
   追加:
     状态栏.历史.女模: 六花
   ```

2. **数值变化必须同时更新描述**
   - 堕落度改变 ≥2 → 同时更新堕落度描述
   - 好感度改变 ≥3 → 同时更新好感度描述
   - 动情程度改变 ≥10 → 同时更新生理状态（乳房、小穴、肛门）

3. **出场女模每轮必须更新**
   - 每轮对话必须包含 `状态栏.世界.出场女模` 的设定
   - 反映当前场景中活跃的女模

---

## 完整示例

```yaml
<plot-log>
记下:
  状态栏.世界.时间: 2024-12-16T18:45:00+0800
  状态栏.世界.出场女模:
    - 六花
    - 梦瑶
  状态栏.女模.六花.想法: 这次拍摄比预期更顺利，他的指导很专业
  状态栏.女模.六花.关系.堕落度: 35
  状态栏.女模.六花.关系.堕落度描述: 开始被利益和诱惑所吸引，底线逐渐动摇
  状态栏.女模.六花.关系.好感度: 45
  状态栏.女模.六花.关系.好感度描述: 对摄影师产生了初步信任，愿意配合更多要求
  状态栏.女模.六花.性爱.动情程度: 60
  状态栏.女模.六花.性爱.乳房: 乳头挺立充血，因兴奋变得深红，敏感度极高
  状态栏.女模.六花.性爱.小穴: 微微湿润，颜色从淡粉渐变为粉红，内部已有收缩反应
  状态栏.女模.六花.性爱.性癖:
    - 反差露出
    - 被观看
  状态栏.女模.梦瑶.想法: 他好像对六花特别感兴趣，我该怎么办
  状态栏.user.拍摄任务.六花--2024-12-31-1430:
    状态: 进行中
    模特: 六花
    目标: 商业写真集拍摄
    期限: 2024-12-31 14:30
    报酬: 5000
    特殊要求: 包含古装和现代风格对比
  状态栏.user.拍摄任务.梦瑶--2025-01-05-晚上:
    状态: 未开始
    模特: 梦瑶
    目标: 大尺度私房摄影
    期限: 2025-01-05 晚上
    报酬: 8000
    特殊要求: 要求私密环境
调整:
  状态栏.user.资金: -3000
  状态栏.女模.六花.关系.好感度: +5
  状态栏.女模.六花.性爱.性经验次数: +1
</plot-log>
```

---

## 女模首次出场完整示例

```yaml
<plot-log>
追加:
  状态栏.历史.女模: 六花

记下:
  状态栏.世界.出场女模:
    - 六花
  状态栏.女模.六花:
    想法: 这就是那个新摄影师吗？看起来还挺认真的
    关系:
      堕落度: 0
      堕落度描述: 坚守自己的底线，对超出职业范围的要求警惕
      好感度: 10
      好感度描述: 初次接触，有基本好感但仍保持警惕
    外型:
      五官: 精致的五官，眼睛明亮有神
      发型: 齐肩黑长直发
      穿搭: 简约白色T恤和牛仔裤
      身高: 170
      体重: 50
      胸围: 86
      腰围: 60
      臀围: 90
      罩杯: C
    职业:
      类型:
        - 学生
        - 兼职模特
      层级: 新手
      方向: 专业
      尺度: 清纯
      人设:
        - 文艺少女
        - 知性
    性爱:
      性癖: []
      性经验次数: 0
      动情程度: 0
</plot-log>
```

**注意**：首次出场时，`性爱.乳房`、`性爱.小穴`、`性爱.肛门` 三个字段**不生成**。仅在动情程度≥10 时才追加这些字段。

---

## 关键注意事项

1. **禁止混淆写法**：不允许在同一 plot-log 中既有展开数组又有方括号数组
2. **禁止部分更新任务**：不允许只更新任务的某个字段，必须全量更新任务对象
3. **禁止自创字段**：所有字段必须严格遵守 schema，不允许新增自定义字段
4. **禁止遗漏必需字段**：新增女模时必须包含完整结构，不允许遗漏任何嵌套层级
5. **强制记录女模历史**：每当新女模首次登场时，必须使用 `追加` 操作将其名字记录到 `历史.女模` 数组中，用于追踪所有出现过的角色

---

## ⚠️ 首次生成女模数据的严格约束

### 首次出场时的必须项

新女模初次生成时**必须生成**以下性爱相关数据：

1. **必须生成性爱基础字段**
   - ✅ `性爱.性癖`: 必须根据角色背景生成合理的性癖数组，不得为空
   - ✅ `性爱.性经验次数`: 必须根据角色职业和年龄生成合理的数值
     - 新手（0-1年）：0-2次
     - 进阶（1-3年）：3-15次
     - 资深（3年+）：15次以上
   - ✅ `性爱.乳房`、`性爱.小穴`、`性爱.肛门`: 必须生成初始状态描述

2. **必须生成性爱生理状态**
   - ✅ 根据年龄和罩杯数据描述 `性爱.乳房`（形状、敏感度等）
   - ✅ 根据年龄和性经验描述 `性爱.小穴`（紧致度、湿润度等）
   - ✅ 必须生成 `性爱.肛门` 字段（初始接受度）

3. **必须生成合理的性倾向**
   - ✅ `性爱.性癖` 数组必须基于角色背景（不是刻板假设）
   - ✅ 应包含对{{user}}的潜在吸引力分析
   - ✅ 描述要点应与职业身份相符

### 首次出场时的禁止项（防止不合理假设）

1. **禁止刻板化的性爱描写**
   - ❌ 禁止包含如 "私密处粉嫩未经人事"、"胸型圆润挺翘"、"臀部小巧紧致" 等陈词滥调
   - ❌ 禁止与年龄/背景明显不符的生理状态（如"30岁却如少女般紧致"）
   - ✅ 性爱描写必须个性化且符合医学常识

2. **禁止矛盾的性倾向设定**
   - ❌ 禁止为新手模特编造过度复杂的性癖
   - ❌ 禁止"保守人设却有极端性癖"这类矛盾设定
   - ✅ 性爱倾向必须与性格和职业背景逻辑一致

3. **禁止编造不合理的背景故事**
   - ❌ 不应有 "初次经验尚未发生，对性充满好奇但也有些紧张" 等刻板假设
   - ❌ 禁止"初次见面却很熟悉你的身体"这类不合理设定
   - ✅ 性经历应与年龄、职业、性经验次数逻辑一致

### 首次出场的规范做法

新女模数据应包含：

- ✅ 基本身份信息（姓名、年龄、身份类型）
- ✅ 外貌数据（五官、发型、穿搭、身高体重等数字型属性）
- ✅ 职业属性（类型、层级、方向、尺度、人设）
- ✅ 初始关系数值（好感度、堕落度均从 0 或适当初值开始）
- ✅ **完整的性爱数据**：
  - 性癖数组（根据背景合理生成）
  - 性经验次数（与职业阶段相符）
  - 性爱生理字段（乳房、小穴、肛门的初始状态）
  - 对{{user}}的性吸引力评估
- ✅ 简洁内心想法（包括对性和感情的看法）

### 动情程度与性爱描写深度的关联规则

| 动情程度 | 性爱数据                                     |
| -------- | -------------------------------------------- |
| 0-9      | 包含基础字段，描述**不涉及生理反应**         |
| 10-39    | 可增加性反应描述，但应**简洁且理性**         |
| 40-69    | 性爱描写可逐步**详细化**，欲望逐步显露      |
| 70-100   | 允许**较详细的性爱描写**，完全释放的欲望状态 |

**强制要求**：每个女模初次生成时必须包含完整的性爱数据，但描写深度应与当前动情程度相符。

</status>

