# 状态栏系统 (plot-log 操作指南)

## ⚠️ 严格规范

### 1. 数组输出格式（必须遵守）

**禁止** 使用 `[item1, item2]` 格式，因为会被整体写成字符串，导致无法识别为数组。

**只能** 使用展开格式：

```yaml
记下:
  状态栏.世界.出场女模:
    - 六花
    - 梦瑶
```

### 2. Schema 严格遵守

- **禁止** 新增或修改任何字段结构（包括字段名、嵌套层级）
- **必须** 完全遵守下述 schema 定义
- 所有 plot-log 输出必须与 status.yaml 的 schema 完全对应

---

## 状态结构 Schema

### 世界 (`状态栏.世界`)

| 字段     | 类型          | 说明                   | 约束                                               |
| -------- | ------------- | ---------------------- | -------------------------------------------------- |
| 时间     | string        | 当前时间               | ISO8601 格式 + 时区，如 `2024-12-16T14:30:00+0800` |
| 地点     | string        | 当前地点               | 格式: `[国家/城市]具体位置`                        |
| 天气     | string        | 天气描述               | 自然语言简述                                       |
| 出场女模 | array(string) | 当前场景中活跃女模名字 | **展开格式数组**，每个元素一行                     |

**出场女模数组 - 唯一正确写法**：

```yaml
记下:
  状态栏.世界.出场女模:
    - 六花
    - 梦瑶
```

---

### User (`状态栏.user`)

#### 基本字段

| 字段       | 类型   | 范围                 | 说明                     |
| ---------- | ------ | -------------------- | ------------------------ |
| 行业等级   | enum   | 专业 \| 资深 \| 名家 | 摄影师专业等级           |
| 堕落度     | int    | 0-100                | 道德堕落程度             |
| 堕落度描述 | string | -                    | 根据堕落度自动生成的描述 |
| 穿搭       | string | -                    | 着装描述                 |
| 想法       | string | -                    | 内心想法                 |
| 资金       | number | -                    | 可用资金                 |

#### 拍摄任务字段 (`状态栏.user.拍摄任务`)

**类型**: object（自由键值对）

**Key 格式** (必须严格遵守)：`模特名--日期-时间`

- 日期: `yyyy-mm-dd` 格式
- 时间: `HHMM` 格式（24小时，无冒号），如 `1430`、`0900`、`晚上`

**任务对象必需字段**（必须每次都包含）：

| 字段     | 类型   | 说明                                               |
| -------- | ------ | -------------------------------------------------- |
| 状态     | enum   | 未开始 \| 进行中 \| 已完成 \| 已取消               |
| 模特     | string | 女模名字                                           |
| 目标     | string | 任务目标/内容描述                                  |
| 期限     | string | 期限日期和时间，格式 `yyyy-mm-dd HH:MM` 或笼统描述 |
| 报酬     | number | 报酬金额                                           |
| 特殊要求 | string | 特殊要求/备注                                      |

**拍摄任务输出格式**（必须严格遵守）：

```yaml
记下:
  状态栏.user.拍摄任务.六花--2024-12-31-1430:
    状态: 未开始
    模特: 六花
    目标: 商业写真集拍摄
    期限: 2024-12-31 14:30
    报酬: 5000
    特殊要求: 包含古装和现代风格对比
```

#### 器材字段 (`状态栏.user.器材`)

**结构**：object，包含以下字段

| 字段      | 类型          | 说明                   |
| --------- | ------------- | ---------------------- |
| 器材.机身 | array(string) | 相机机身列表，展开格式 |
| 器材.镜头 | array(string) | 镜头列表，展开格式     |
| 器材.灯光 | array(string) | 灯光设备列表，展开格式 |
| 器材.配件 | array(string) | 配件列表，展开格式     |
| 器材.其他 | array(string) | 其他器材列表，展开格式 |

---

### 女模 (`状态栏.女模.{角色名}`)

**结构**: object，key 为角色名（唯一标识），value 为该角色的完整数据对象

#### 女模的完整 Schema

每个女模对象必须包含以下结构（新女模首次出现时必须生成完整数据）：

```
女模.{角色名}:
  想法: string
  关系:
    堕落度: int(0-100)
    堕落度描述: string
    好感度: int(-100~100)
    好感度描述: string
  外型:
    五官: string
    发型: string
    穿搭: string
    身高: int(168-178)
    体重: int(48-58)
    胸围: int(83-90)
    腰围: int(58-64)
    臀围: int(88-95)
    罩杯: string
  职业:
    类型: array(string)
    层级: enum(新手|进阶|专业)
    方向: enum(专业|多元|退出|卖身)
    尺度: enum(清纯|性感|大尺度|私密)
    人设: array(string)
  性爱:
    性癖: array(string)
    性经验次数: int(0-10000)
    动情程度: int(0-100)
    乳房: string
    小穴: string
    肛门: string
```

#### 女模字段详细规范

| 字段路径        | 类型   | 范围                     | 说明              | 更新规则                     |
| --------------- | ------ | ------------------------ | ----------------- | ---------------------------- |
| 想法            | string | -                        | 内心独白          | 每轮对话至少更新一次         |
| 关系.堕落度     | int    | 0-100                    | 道德堕落程度      | 变化≥2 时同时更新描述        |
| 关系.堕落度描述 | string | -                        | 堕落状态文字描述  | 必须同步于堕落度数值         |
| 关系.好感度     | int    | -100~100                 | 对摄影师的感受    | 变化≥3 时同时更新描述        |
| 关系.好感度描述 | string | -                        | 关系状态文字描述  | 必须同步于好感度数值         |
| 外型.\*         | 见上表 | -                        | 身体特征          | 一般不变                     |
| 职业.类型       | array  | -                        | 职业标签列表      | 追加新类型                   |
| 职业.层级       | enum   | 新手\|进阶\|专业         | 模特等级          | 直接覆盖                     |
| 职业.方向       | enum   | 专业\|多元\|退出\|卖身   | 职业方向          | 直接覆盖                     |
| 职业.尺度       | enum   | 清纯\|性感\|大尺度\|私密 | 可接受尺度        | 直接覆盖                     |
| 职业.人设       | array  | -                        | 人设/称呼标签列表 | 追加新标签                   |
| 性爱.性癖       | array  | -                        | 性癖好列表        | 追加新性癖                   |
| 性爱.性经验次数 | int    | 0-10000                  | 累计次数          | 有性行为后调整 +1            |
| 性爱.动情程度   | int    | 0-100                    | 当前兴奋程度      | 实时变化，≥10 时更新生理状态 |
| 性爱.乳房       | string | -                        | 乳房乳头状态      | 动情程度变化时更新           |
| 性爱.小穴       | string | -                        | 阴部状态          | 动情程度变化时更新           |
| 性爱.肛门       | string | -                        | 菊花状态          | 动情程度变化时更新           |

---

## Plot-log 操作说明

### 操作类型

| 操作 | 说明                    | 使用场景                       |
| ---- | ----------------------- | ------------------------------ |
| 记下 | 直接设置/覆盖值         | 新增、替换、覆盖任何字段       |
| 调整 | 对数值增加或减少（+/-） | 调整数值型字段（金钱、度数等） |
| 追加 | 向数组添加新元素        | 数组字段新增项                 |
| 删除 | **仅能** 删除顶层变量   | 很少使用                       |

### 强制规范

1. **数组必须展开**

   ```yaml
   # ✅ 正确
   状态栏.世界.出场女模:
     - 六花
     - 梦瑶

   # ❌ 错误（会被整体写成字符串）
   状态栏.世界.出场女模: [六花, 梦瑶]
   ```

2. **每次任务更新必须包含所有必需字段**

   ```yaml
   # ✅ 正确（完整的任务对象）
   记下:
     状态栏.user.拍摄任务.六花--2024-12-31-1430:
       状态: 进行中
       模特: 六花
       目标: 商业写真
       期限: 2024-12-31 14:30
       报酬: 5000
       特殊要求: 古装风格

   # ❌ 错误（缺少必需字段）
   记下:
     状态栏.user.拍摄任务.六花--2024-12-31-1430.状态: 进行中
   ```

3. **女模首次出场必须生成完整结构，并记录到历史**
   - 新女模第一次出现时，必须输出完整的女模数据对象
   - 包含所有嵌套的字段（想法、关系、外型、职业、性爱）
   - 不允许缺失任何一级结构
   - **强制要求**：使用 `追加` 操作将女模名字记录到 `状态栏.历史.女模` 数组中

   ```yaml
   追加:
     状态栏.历史.女模: 六花
   ```

4. **数值变化必须同时更新描述**
   - 堕落度改变 ≥2 → 同时更新堕落度描述
   - 好感度改变 ≥3 → 同时更新好感度描述
   - 动情程度改变 ≥10 → 同时更新生理状态（乳房、小穴、肛门）

5. **出场女模每轮必须更新**
   - 每轮对话必须包含 `状态栏.世界.出场女模` 的设定
   - 反映当前场景中活跃的女模

---

## 完整示例

```yaml
<plot-log>
记下:
  状态栏.世界.时间: 2024-12-16T18:45:00+0800
  状态栏.世界.出场女模:
    - 六花
    - 梦瑶
  状态栏.女模.六花.想法: 这次拍摄比预期更顺利，他的指导很专业
  状态栏.女模.六花.关系.堕落度: 35
  状态栏.女模.六花.关系.堕落度描述: 开始被利益和诱惑所吸引，底线逐渐动摇
  状态栏.女模.六花.关系.好感度: 45
  状态栏.女模.六花.关系.好感度描述: 对摄影师产生了初步信任，愿意配合更多要求
  状态栏.女模.六花.性爱.动情程度: 60
  状态栏.女模.六花.性爱.乳房: 乳头挺立充血，因兴奋变得深红，敏感度极高
  状态栏.女模.六花.性爱.小穴: 微微湿润，颜色从淡粉渐变为粉红，内部已有收缩反应
  状态栏.女模.六花.性爱.性癖:
    - 反差露出
    - 被观看
  状态栏.女模.梦瑶.想法: 他好像对六花特别感兴趣，我该怎么办
  状态栏.user.拍摄任务.六花--2024-12-31-1430:
    状态: 进行中
    模特: 六花
    目标: 商业写真集拍摄
    期限: 2024-12-31 14:30
    报酬: 5000
    特殊要求: 包含古装和现代风格对比
  状态栏.user.拍摄任务.梦瑶--2025-01-05-晚上:
    状态: 未开始
    模特: 梦瑶
    目标: 大尺度私房摄影
    期限: 2025-01-05 晚上
    报酬: 8000
    特殊要求: 要求私密环境
调整:
  状态栏.user.资金: -3000
  状态栏.女模.六花.关系.好感度: +5
  状态栏.女模.六花.性爱.性经验次数: +1
</plot-log>
```

---

## 女模首次出场完整示例

```yaml
<plot-log>
追加:
  状态栏.历史.女模: 六花

记下:
  状态栏.世界.出场女模:
    - 六花
  状态栏.女模.六花:
    想法: 这就是那个新摄影师吗？看起来还挺认真的
    关系:
      堕落度: 0
      堕落度描述: 坚守自己的底线，对超出职业范围的要求警惕
      好感度: 10
      好感度描述: 初次接触，有基本好感但仍保持警惕
     外型:
       五官: 精致的五官，眼睛明亮有神
       发型: 齐肩黑长直发
       穿搭: 简约白色T恤和牛仔裤
       身高: 170
       体重: 50
       胸围: 86
       腰围: 60
       臀围: 90
       罩杯: C
    职业:
      类型:
        - 学生
        - 兼职模特
      层级: 新手
      方向: 专业
      尺度: 清纯
      人设:
        - 文艺少女
        - 知性
    性爱:
      性癖: []
      性经验次数: 0
      动情程度: 0
      乳房: 胸部未经开发，乳头呈淡粉色，处于完全放松状态
      小穴: 未有性经历，颜色淡粉，完全干涩，紧闭状态
      肛门: 未有开发，紧闭，颜色浅粉
</plot-log>
```

---

## 关键注意事项

1. **禁止混淆写法**：不允许在同一 plot-log 中既有展开数组又有方括号数组
2. **禁止部分更新任务**：不允许只更新任务的某个字段，必须全量更新任务对象
3. **禁止自创字段**：所有字段必须严格遵守 schema，不允许新增自定义字段
4. **禁止遗漏必需字段**：新增女模时必须包含完整结构，不允许遗漏任何嵌套层级
5. **强制记录女模历史**：每当新女模首次登场时，必须使用 `追加` 操作将其名字记录到 `历史.女模` 数组中，用于追踪所有出现过的角色
