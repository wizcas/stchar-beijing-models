---
rule_name: Plot-Log 格式规范（核心规范）
rule_key: plot-log,JSON,数组格式,强制规则,检查清单
version: 2
rule_type: 技术规范
rule_type_describe: Plot-log 输出的强制格式规范（JSON 标准）。
filename: plot-log-format-guide.md
---

<plot-log-format-guide>

# Plot-Log 格式规范（核心规范）

**优先级**：🔴 **最高** - 必须无条件遵守

---

## 🔴 四大强制要求

### 📌 要求 1：COT 思维链必须在开头输出

**强制规则**：

- ✅ \*\*每次 AI 输出必须以 `<cot>...</cot>` 开头
- ✅ ** COT 必须输出七步完整问答**（第一步到第七步）
- ✅ \*\*COT 必须在正文之前
- ❌ 不允许跳过任何 COT 步骤
- ❌ 违反上述规则将导致系统崩溃

**必须包含的七步**：

1. **第0步**：计算推进时间
1. **第1步**：确认互动对象（是否正在与女模互动？）
1. **第2步**：更新出场女模列表（哪些女模当前在场？）
1. **第3步**：更新女模数据（女模属性是否需要更新？）
1. **第4步**：检查女模退场（是否有女模离开？）
1. **第5步**：检查拍摄任务（任务状态是否变化？）
1. **第6步**：更新 user 数据（玩家属性是否变化？）
1. **第7步**：生成推进选项（下一步有哪些选择？）

---

### 📌 要求 2：plot-log 中动作必须单一且合并

**强制规则**：

- ✅ 每次 AI 输出必须以 `<plot-log></plot-log>` 结尾\*\*
- ✅ `"记下"` - 只能出现**一次**，所有赋值合并
- ✅ `"调整"` - 只能出现**一次**，所有调整合并
- ✅ `"追加"` - 只能出现**一次**，所有追加合并
- ✅ `"删除"` - 只能出现**一次**（如有必要）
- ✅ plot-log 必须出现在正文之后
- ❌ **绝对禁止**：同一个动作出现多次
- ❌ 违反上述规则将导致系统崩溃

**JSON 示例**（简化版）：

```json
{
  "记下": { "状态栏.女模.六花.想法": "新想法" },
  "调整": { "状态栏.女模.六花.关系.好感度": "+15" },
  "追加": { "状态栏.女模.六花.性爱.性癖": ["角色扮演"] }
}
```

---

### 📌 要求 3：JSON 必须合法可解析

**强制规则**：

- ✅ JSON 必须能被 `JSON.parse()` 成功解析
- ✅ 所有键和字符串值必须使用双引号 `""`
- ✅ 所有数字不使用引号
- ✅ 所有布尔值使用 `true`/`false`（小写）
- ✅ 数组使用 `[]`，对象使用 `{}`
- ✅ 逗号分隔符位置正确（最后一项无逗号）
- ❌ **禁止**单引号 `''`、注释、行尾逗号

---

## 🔴 最强制的核心规则

### 1. JSON 数组格式 - 绝对禁止 YAML 格式

```json
// ❌ 绝对禁止（YAML 展开式）
状态栏.世界.出场女模:
  - 六花
  - 梦瑶

// ✅ 唯一正确方式（JSON 数组）
{"状态栏.世界.出场女模": ["六花", "梦瑶"]}
```

---

### 2. Schema 完全遵守

- ✅ 不允许新增字段
- ✅ 不允许删除必需字段
- ✅ 不允许改变嵌套结构
- ✅ 字段路径必须完全匹配 status.md schema

---

### 3. 任务必须完整（所有 6 个字段）

任务 Key 格式：`模特名--yyyy-mm-dd-HHMM`（双破折号）

任务必须包含：`状态`、`模特`、`目标`、`期限`、`报酬`、`特殊要求`

---

### 4. 数值变更必须同时更新关联字段（🔴 严重错误项）

⚠️ **详细规则和检查清单请参考** `<status />`

**核心原则**：

- ✅ 更新 user 堕落度 → 必须同时更新堕落度描述
- ✅ 更新女模好感度 → 必须同时更新好感度描述
- ✅ 更新女模堕落度 → 必须同时更新堕落度描述
- ✅ 更新女模动情程度≥10 → 必须同时更新乳房、小穴、肛门
- ❌ 禁止只更新数值，遗漏任何关联字段

---

## 操作类型速查表

### 操作 1：记下（赋值/覆盖）

```json
{
  "记下": {
    "状态栏.女模.六花.想法": "新想法",
    "状态栏.女模.六花.关系.好感度描述": "描述"
  }
}
```

### 操作 2：调整（数值增减）

```json
{
  "调整": { "状态栏.女模.六花.关系.好感度": "+15", "状态栏.user.资金": "-2500" }
}
```

> 必须有 +/- 符号，使用字符串格式

### 操作 3：追加（添加到数组）

```json
{ "追加": { "状态栏.女模.六花.性爱.性癖": ["角色扮演", "反差露出"] } }
```

---

## 📋 快速检查清单

**格式检查**（7项）：

- [ ] 使用 JSON `[]` 格式，不用 YAML `-`
- [ ] `"记下"` 只出现 1 次
- [ ] `"调整"` 只出现 1 次
- [ ] `"追加"` 只出现 1 次
- [ ] JSON 能被 `JSON.parse()` 解析
- [ ] 所有中文字段名是简体中文，严禁繁体
- [ ] 所有字符串用双引号、数字不用引号

**内容检查**（7项）：

- [ ] 时间推进和天气变化已计算
- [ ] 出场女模与场景一致
- [ ] 任务包含全部 6 个字段
- [ ] 推进选项恰好 4 个（2 积极 + 2 消极）
- [ ] 更新好感度 → 同时更新好感度描述
- [ ] 更新堕落度 → 同时更新堕落度描述
- [ ] 动情程度≥10 → 同时更新乳房、小穴、肛门

---

## Schema 一致性检查

- [ ] 所有字段都在 <status /> schema 中定义
- [ ] 嵌套结构完全匹配
- [ ] 新女模包含完整结构（关系、外型、职业、性爱）
- [ ] 推进选项有 emoji、选项文本、方向三个字段

---

## 推进选项（必须包含 4 个）

```json
{
  "推进选项": [
    { "emoji": "📸", "选项": "继续拍摄", "方向": "积极" },
    { "emoji": "💬", "选项": "深入沟通", "方向": "积极" },
    { "emoji": "💰", "选项": "提高报酬", "方向": "消极" },
    { "emoji": "⏭️", "选项": "结束拍摄", "方向": "消极" }
  ]
}
```

**强制规则**：

- ✅ 必须 4 个选项，2 个积极 + 2 个消极（固定比例）
- ❌ 禁止 1、2、3、5 个或其他比例

---

## 数组字段完整列表

| 字段路径                     | 用途                                     |
| ---------------------------- | ---------------------------------------- |
| `状态栏.世界.出场女模`       | 当前场景女模列表                         |
| `状态栏.女模.{名}.职业.类型` | 职业类型（学生、模特等）                 |
| `状态栏.女模.{名}.职业.人设` | 人设标签                                 |
| `状态栏.女模.{名}.性爱.性癖` | 性癖列表                                 |
| `状态栏.user.器材.*`         | 相机器材（机身、镜头、灯光、配件、其他） |
| `状态栏.历史.女模`           | 历史女模记录                             |

---

## 🔴 不可妥协的强制规则（必须 100% 遵守）

1. **必须使用 JSON 格式，绝对禁止 YAML 格式**
   - 禁止使用 `-` 开头的数组
   - 必须使用 `[]` JSON 格式
   - 所有字符串必须用双引号

2. **Schema 字段必须完全匹配**
   - 不允许创造新字段
   - 不允许省略必需字段
   - 不允许改变嵌套层级

3. **任务更新必须完整**
   - 每次更新都是全量覆盖
   - 必须包含所有 6 个字段

4. **JSON 格式必须正确**
   - 数字不使用引号
   - 字符串使用双引号
   - 调整操作值为字符串格式（`"+10"` 不是 `+10`）

5. **严禁使用繁体中文**
   - 所有中文字段名必须是简体中文
   - 禁止繁体中文（如：狀態欄、關係、性愛）

---

- **完整 Schema 定义**：见 <status />
- **COT 思维链规则**：见 <COT-instructions />

---

</plot-log-format-guide>
