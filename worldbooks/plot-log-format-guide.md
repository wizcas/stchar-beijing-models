---
rule_name: Plot-Log 格式强化指南
rule_key: plot-log格式,YAML规范,数组展开,status.yaml schema,强制输出
version: 1
rule_type: 技术规范
rule_type_describe: 统一规范所有 plot-log 输出的格式，确保严格遵守 YAML 标准和 status.yaml schema 定义，任何情况下都不允许偏差。
filename: plot-log-format-guide.md
---

<plot-log-format-guide>

# Plot-Log 格式强化指南

**优先级**：🔴 **最高** - 此规范必须无条件遵守，是确保游戏系统稳定运行的唯一保障

---

## 核心原则

### 1. 绝对遵守 Status.yaml Schema

- **所有 plot-log 输出必须完全遵照下文描述的规则**
- **不允许新增、修改或删除任何字段**
- **不允许改变字段的嵌套结构**
- **不允许使用未在 schema 中定义的字段名**

### 2. YAML 展开式数组是唯一标准

- ❌ **绝对禁止**：`[item1, item2, item3]`（方括号/JSON 数组格式）
- ✅ **唯一允许**：YAML 展开式数组（每个元素一行，以 `-` 开头）

---

## 数组类型字段的强制规范

### 出场女模 (`状态栏.世界.出场女模`)

**字段类型**：`array(string)`

#### ❌ 错误写法

```yaml
# 错误 1：方括号格式
记下:
  状态栏.世界.出场女模: ["六花", "梦瑶"]

# 错误 2：混合格式（致命错误）
记下:
  状态栏.世界.出场女模:
    - 六花
    值: ["梦瑶"]

# 错误 3：行内数组
记下:
  状态栏.世界.出场女模: [六花, 梦瑶]

# 错误 4：缺失 - 符号
记下:
  状态栏.世界.出场女模:
    六花
    梦瑶
```

#### ✅ 正确写法

```yaml
# 正确：YAML 展开式数组
记下:
  状态栏.世界.出场女模:
    - 六花
    - 梦瑶
```

**强制检查清单**：

- ✅ 每个元素前有 `-` 和空格
- ✅ 每个元素占一行
- ✅ 缩进保持一致
- ✅ 元素值为基础类型（不是对象/数组）

---

### 职业类型 (`状态栏.女模.{名字}.职业.类型`)

**字段类型**：`array(string)`

#### ❌ 错误写法

```yaml
记下:
  状态栏.女模.六花.职业.类型: ["学生", "兼职模特"]
```

#### ✅ 正确写法

```yaml
记下:
  状态栏.女模.六花.职业.类型:
    - 学生
    - 兼职模特
```

---

### 人设标签 (`状态栏.女模.{名字}.职业.人设`)

**字段类型**：`array(string)`

#### ❌ 错误写法

```yaml
记下:
  状态栏.女模.六花.职业.人设: ["文艺少女", "知性"]
```

#### ✅ 正确写法

```yaml
记下:
  状态栏.女模.六花.职业.人设:
    - 文艺少女
    - 知性
```

---

### 性癖列表 (`状态栏.女模.{名字}.性爱.性癖`)

**字段类型**：`array(string)`

#### ❌ 错误写法

```yaml
记下:
  状态栏.女模.六花.性爱.性癖: ["角色扮演", "反差露出"]
```

#### ✅ 正确写法

```yaml
记下:
  状态栏.女模.六花.性爱.性癖:
    - 角色扮演
    - 反差露出
```

**特殊注意**：

- 初始状态必须为空数组：`性癖: []` → 转为展开式时：
  ```yaml
  性癖: []
  ```
  或直接不包含该字段，仅在有性癖时才添加

---

### 器材列表 (`状态栏.user.器材.{类别}`)

**字段类型**：`array(string)`

涉及以下子字段：

- `器材.机身`
- `器材.镜头`
- `器材.灯光`
- `器材.配件`
- `器材.其他`

#### ❌ 错误写法

```yaml
记下:
  状态栏.user.器材.机身: ["Canon 5D Mark IV", "Nikon Z9"]
  状态栏.user.器材.镜头: ["85mm f/1.8", "50mm f/1.4"]
```

#### ✅ 正确写法

```yaml
记下:
  状态栏.user.器材.机身:
    - Canon 5D Mark IV
    - Nikon Z9
  状态栏.user.器材.镜头:
    - 85mm f/1.8
    - 50mm f/1.4
```

---

## 复杂嵌套结构的规范

### 拍摄任务完整结构

**路径**：`状态栏.user.拍摄任务.{任务ID}`

#### ❌ 错误写法

```yaml
# 错误：字段不完整或使用了简写
记下:
  状态栏.user.拍摄任务.六花--2024-12-28-1430:
    状态: 进行中
    # 缺少其他字段

# 错误：使用方括号格式的特殊要求或其他数组
记下:
  状态栏.user.拍摄任务.六花--2024-12-28-1430:
    特殊要求: ["古装风格", "现代对比"]
```

#### ✅ 正确写法

```yaml
记下:
  状态栏.user.拍摄任务.六花--2024-12-28-1430:
    状态: 进行中
    模特: 六花
    目标: 商业写真集
    期限: 2024-12-28 14:30
    报酬: 5000
    特殊要求: 古装和现代风格对比
```

**强制规则**：

- ✅ 每次更新任务都必须包含所有 6 个字段
- ✅ 特殊要求用自然语言描述，不使用数组格式
- ✅ 日期时间格式严格按 `yyyy-mm-dd HH:MM` 或笼统描述

---

### 女模首次出场的完整结构

#### ❌ 错误写法

```yaml
记下:
  状态栏.女模.六花:
    想法: 这就是那个新摄影师吗？看起来还挺认真的
    关系:
      堕落度: 0
      好感度: 10
    外型:
      五官: 精致的五官，眼睛明亮有神
      发型: 齐肩黑长直发
    职业:
      类型: ["学生", "兼职模特"] # ❌ 错误：方括号
      人设: ["文艺少女", "知性"] # ❌ 错误：方括号
    性爱:
      性癖: ["角色扮演"] # ❌ 错误：方括号
```

#### ✅ 正确写法

```yaml
记下:
  状态栏.女模.六花:
    想法: 这就是那个新摄影师吗？看起来还挺认真的
    关系:
      堕落度: 0
      堕落度描述: 坚守自己的底线，对超出职业范围的要求警惕
      好感度: 10
      好感度描述: 初次接触，有基本好感但仍保持警惕
    外型:
      五官: 精致的五官，眼睛明亮有神
      发型: 齐肩黑长直发
      穿搭: 简约白色T恤和牛仔裤
      身高: 170
      体重: 50
      胸围: 86
      腰围: 60
      臀围: 90
      罩杯: C
    职业:
      类型:
        - 学生
        - 兼职模特
      层级: 新手
      方向: 专业
      尺度: 清纯
      人设:
        - 文艺少女
        - 知性
    性爱:
      性癖: []
      性经验次数: 0
      动情程度: 0
```

---

## 各操作类型的规范

### 操作 1：记下（直接设置/覆盖）

**用途**：新增字段或完全覆盖值

#### 单字段更新

```yaml
记下:
  状态栏.女模.六花.想法: 新的想法内容
```

#### 多字段批量更新

```yaml
记下:
  状态栏.世界.时间: 2024-12-28T15:30:00+0800
  状态栏.世界.地点: "[中国/北京]工作室
  状态栏.女模.六花.想法: 更新的想法
  状态栏.女模.六花.关系.好感度描述: 更新的描述
```

#### 数组字段更新（绝对禁止方括号）

```yaml
# ❌ 错误
记下:
  状态栏.女模.六花.职业.类型: ["学生", "模特"]

# ✅ 正确
记下:
  状态栏.女模.六花.职业.类型:
    - 学生
    - 模特
```

#### 对象字段更新

```yaml
# 完整子对象
记下:
  状态栏.女模.六花.外型:
    五官: 精致的五官，眼睛明亮有神
    发型: 齐肩黑长直发
    穿搭: 简约白色T恤
    身高: 170
    体重: 50
    胸围: 86
    腰围: 60
    臀围: 90
    罩杯: C
```

---

### 操作 2：调整（数值增减）

**用途**：对数字型字段进行 +/- 操作

```yaml
调整:
  状态栏.女模.六花.关系.好感度: +10
  状态栏.女模.六花.关系.堕落度: +5
  状态栏.女模.六花.性爱.动情程度: +20
  状态栏.user.资金: -5000
```

**强制规则**：

- ✅ 仅用于数字字段（int、float）
- ✅ 必须包含 +/- 符号
- ✅ 数值必须是数字，不能是字符串

---

### 操作 3：追加（向数组添加新元素）

**用途**：向现有数组追加新元素

#### ❌ 错误写法

```yaml
# 错误 1：直接赋值
追加:
  状态栏.女模.六花.职业.类型: "新模特"

# 错误 2：使用方括号
追加:
  状态栏.女模.六花.职业.类型: ["新模特"]

# 错误 3：多个元素用逗号分隔
追加:
  状态栏.女模.六花.职业.类型: 新模特, 另一种类型
```

#### ✅ 正确写法

```yaml
# 正确 1：单元素追加
追加:
  状态栏.女模.六花.职业.类型: 新模特

# 正确 2：多元素逐个追加
追加:
  状态栏.女模.六花.职业.类型: 新模特
  状态栏.女模.六花.职业.类型: 另一种类型

# 正确 3：性癖追加示例
追加:
  状态栏.女模.六花.性爱.性癖: 角色扮演
  状态栏.女模.六花.性爱.性癖: 反差露出
```

---

## 完整 Plot-Log 输出示例

### 场景 1：首次女模出场

```yaml
<plot-log>
追加:
  状态栏.历史.女模: 六花

记下:
  状态栏.世界.时间: 2024-12-28T14:00:00+0800
  状态栏.世界.地点: "[中国/北京]工作室"
  状态栏.世界.出场女模:
    - 六花
  状态栏.女模.六花:
    想法: 这就是那个新摄影师吗？看起来还挺认真的
    关系:
      堕落度: 0
      堕落度描述: 坚守自己的底线，对超出职业范围的要求警惕
      好感度: 10
      好感度描述: 初次接触，有基本好感但仍保持警惕
    外型:
      五官: 精致的五官，眼睛明亮有神
      发型: 齐肩黑长直发
      穿搭: 简约白色T恤和牛仔裤
      身高: 170
      体重: 50
      胸围: 86
      腰围: 60
      臀围: 90
      罩杯: C
    职业:
      类型:
        - 学生
        - 兼职模特
      层级: 新手
      方向: 专业
      尺度: 清纯
      人设:
        - 文艺少女
        - 知性
    性爱:
      性癖: []
      性经验次数: 0
      动情程度: 0
  状态栏.user.拍摄任务.六花--2024-12-28-1430:
    状态: 未开始
    模特: 六花
    目标: 商业写真集
    期限: 2024-12-28 14:30
    报酬: 2500
    特殊要求: 无
</plot-log>
```

### 场景 2：中途更新（多字段变化）

```yaml
<plot-log>
记下:
  状态栏.世界.出场女模:
    - 六花
  状态栏.女模.六花.想法: 他的指导很专业，我有点被吸引了
  状态栏.女模.六花.关系.好感度描述: 初步产生好感，愿意配合更多拍摄要求

调整:
  状态栏.女模.六花.关系.好感度: +15
  状态栏.女模.六花.关系.堕落度: +5
  状态栏.女模.六花.性爱.动情程度: +10

记下:
  状态栏.user.拍摄任务.六花--2024-12-28-1430:
    状态: 进行中
    模特: 六花
    目标: 商业写真集
    期限: 2024-12-28 14:30
    报酬: 2500
    特殊要求: 无
</plot-log>
```

### 场景 3：多女模同时出场

```yaml
<plot-log>
记下:
  状态栏.世界.出场女模:
    - 六花
    - 梦瑶
  状态栏.女模.六花.想法: 梦瑶也来了，她在这方面比我有经验
  状态栏.女模.梦瑶.想法: 六花还是有点紧张，我应该帮她缓解一下

调整:
  状态栏.女模.六花.关系.好感度: +5
  状态栏.女模.梦瑶.关系.好感度: +8

记下:
  状态栏.user.拍摄任务.梦瑶--2024-12-28-1500:
    状态: 进行中
    模特: 梦瑶
    目标: 艺术写真
    期限: 2024-12-28 15:00
    报酬: 3500
    特殊要求: 强调气质
</plot-log>
```

### 场景 4：追加性癖和装备

```yaml
<plot-log>
记下:
  状态栏.世界.出场女模:
    - 六花

调整:
  状态栏.女模.六花.性爱.动情程度: +25

追加:
  状态栏.女模.六花.性爱.性癖: 被观看
  状态栏.女模.六花.性爱.性癖: 角色扮演

记下:
  状态栏.user.器材.镜头:
    - 85mm f/1.8
    - 50mm f/1.4
  状态栏.user.器材.灯光:
    - 环形灯
    - 柔光箱
</plot-log>
```

---

## 关键检查清单（每次输出前必读）

### 数组字段检查

- [ ] 所有数组字段都使用 YAML 展开式（`-` 开头，每行一个）
- [ ] 没有任何字段使用 `[item1, item2]` 格式
- [ ] 没有混合使用展开式和方括号式
- [ ] 空数组使用 `[]` 或完全省略

### Schema 一致性检查

- [ ] 不存在 schema 中没有定义的字段
- [ ] 嵌套结构与 status.md 中的定义完全相同
- [ ] 所有对象字段都包含 schema 要求的子字段

### 任务格式检查

- [ ] 任务 Key 格式为 `模特名--yyyy-mm-dd-HHMM`（双破折号）
- [ ] 任务对象包含所有 6 个必需字段
- [ ] 期限格式为 `yyyy-mm-dd HH:MM` 或笼统描述

### YAML 格式检查

- [ ] 缩进一致（通常 2 个空格）
- [ ] 没有 Tab 字符，全部使用空格
- [ ] 冒号后面都有空格
- [ ] 字符串不需要额外引号（除非包含特殊字符）

### 出场女模列表检查

- [ ] 每个女模占一行，前缀 `-`
- [ ] 使用展开式格式
- [ ] 没有重复的女模名字
- [ ] 与实际场景中的女模一致

---

## 常见错误示范与纠正

### 错误 1：混淆数组格式

```yaml
# ❌ 错误
记下:
  状态栏.世界.出场女模: ["六花", "梦瑶"]

# ✅ 纠正
记下:
  状态栏.世界.出场女模:
    - 六花
    - 梦瑶
```

### 错误 2：对象字段不完整

```yaml
# ❌ 错误
记下:
  状态栏.女模.六花:
    想法: 新想法

# ✅ 纠正（首次出场）
记下:
  状态栏.女模.六花:
    想法: 新想法
    关系:
      堕落度: 0
      堕落度描述: ...
      好感度: 10
      好感度描述: ...
    外型:
      五官: ...
      # ... 所有字段
    职业:
      类型:
        - ...
      层级: ...
      # ... 所有字段
    性爱:
      性癖: []
      性经验次数: 0
      动情程度: 0
```

### 错误 3：任务格式不规范

```yaml
# ❌ 错误 1：单破折号
记下:
  状态栏.user.拍摄任务.六花-2024-12-28-1430:

# ❌ 错误 2：缺少字段
记下:
  状态栏.user.拍摄任务.六花--2024-12-28-1430:
    状态: 进行中

# ✅ 正确
记下:
  状态栏.user.拍摄任务.六花--2024-12-28-1430:
    状态: 进行中
    模特: 六花
    目标: 商业写真集
    期限: 2024-12-28 14:30
    报酬: 5000
    特殊要求: 无
```

### 错误 4：追加操作误用

```yaml
# ❌ 错误 1：直接赋值
追加:
  状态栏.女模.六花.职业.类型: ["新类型"]

# ❌ 错误 2：多元素合并
追加:
  状态栏.女模.六花.职业.类型: 类型1, 类型2

# ✅ 正确
追加:
  状态栏.女模.六花.职业.类型: 新类型
```

---

## 工具化验证（AI 必读）

### 输出前的自检流程

在生成任何 plot-log 前，必须执行以下检查：

1. **数组类型识别**
   - 检查所有 array 类型字段
   - 确保全部使用展开式格式

2. **Schema 对比**
   - 将输出的字段与 @status.md 中的 schema 逐一对比
   - 确保没有多余或缺失的字段

3. **格式验证**
   - 验证所有 YAML 缩进
   - 检查没有混淆的数组格式

4. **完整性检查**
   - 新女模必须包含完整结构
   - 任务必须包含所有 6 个字段
   - 对象字段必须完整

5. **一致性校验**
   - 出场女模列表与实际场景一致
   - 数据变化有剧情原因支撑

---

## 最终强制规则

### 🔴 不可妥协的规范

1. **任何数组字段都不允许使用 `[item1, item2]` 格式**
   - 这是造成数据解析错误的主要原因
   - 必须 100% 遵守展开式格式

2. **Schema 字段必须完全匹配**
   - 不允许创造新字段
   - 不允许省略必需字段
   - 不允许改变嵌套层级

3. **每次任务更新必须完整**
   - 不允许只更新某个字段
   - 必须全量覆盖任务对象

4. **YAML 格式必须正确**
   - 使用空格缩进（不用 Tab）
   - 冒号后跟空格
   - 没有混淆的格式

---

**本文档是所有 plot-log 输出的唯一标准，任何偏差都属于严重错误。**
</plot-log-format-guide>
